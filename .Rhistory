library(data.table)
library(dplyr)
library(here)
library(ggplot2)
library(ggspatial)
library(glue)
library(ptaxsim)
library(sf)
library(tidyr)
ptaxsim_db_conn <- DBI::dbConnect(RSQLite::SQLite(), here("ptaxsim.db"))
example_pin10 <- "1536100028"
example_pin14 <- "15361000280000"
shp_bnd_cook <- read_sf(paste0(
"https://opendata.arcgis.com/api/v3/datasets/",
"ea127f9e96b74677892722069c984198_1/downloads/data?",
"format=geojson&spatialRefId=4326&where=1%3D1"
)) %>%
select(geometry) %>%
st_transform(3435)
shp_bnd_municipalities <- read_sf(paste0(
"https://opendata.arcgis.com/api/v3/datasets/",
"534226c6b1034985aca1e14a2eb234af_2/downloads/data?",
"format=geojson&spatialRefId=4326&where=1%3D1"
))
shp_bnd_riverside <- shp_bnd_municipalities %>%
filter(AGENCY_DESC == "VILLAGE OF RIVERSIDE") %>%
select(agency = AGENCY, name = AGENCY_DESC) %>%
mutate(agency = "31090000")
shp_bnd_chicago <- shp_bnd_municipalities %>%
filter(AGENCY_DESC == "CITY OF CHICAGO") %>%
select(agency = AGENCY, name = AGENCY_DESC)
shp_bnd_example_pin <- read_sf(glue(
"https://datacatalog.cookcountyil.gov/resource/",
"77tz-riq7.geojson?pin10={example_pin10}"))
shp_bnd_riverside_pins <- read_sf(glue(
"https://datacatalog.cookcountyil.gov/resource/",
"77tz-riq7.geojson?MUNICIPALITY=Riverside&$limit=100000"
)) %>%
select(pin10, geometry) %>%
filter(as.logical(st_intersects(st_centroid(.), shp_bnd_riverside)))
shp_bnd_elem_dist <- read_sf(paste0(
"https://opendata.arcgis.com/api/v3/datasets/",
"cbcf6b1c3aaa420d90ccea6af877562b_2/downloads/data?",
"format=geojson&spatialRefId=4326&where=1%3D1"
)) %>%
filter(AGENCY_DESCRIPTION == "SCHOOL DISTRICT 96")
shp_bnd_elem_dist_pins <- read_sf(glue(
"https://datacatalog.cookcountyil.gov/resource/",
"77tz-riq7.geojson?elemschltaxdist=SCHOOL%20DISTRICT%2096",
"&$limit=100000"
)) %>%
filter(!pin10 %in% shp_bnd_riverside_pins$pin10) %>%
filter(is.na(as.logical(st_intersects(st_centroid(.), shp_bnd_riverside))))
shp_bnd_township <- read_sf(paste0(
"https://opendata.arcgis.com/api/v3/datasets/",
"78fe09c5954e41e19b65a4194eed38c7_3/downloads/data?",
"format=geojson&spatialRefId=4326&where=1%3D1"
)) %>%
filter(NAME == "RIVERSIDE")
shp_bnd_township_pins <- read_sf(glue(
"https://datacatalog.cookcountyil.gov/resource/",
"77tz-riq7.geojson?politicaltownship=Town%20of%20Riverside",
"&$limit=50000"
)) %>%
filter(!pin10 %in% shp_bnd_riverside_pins$pin10) %>%
filter(!pin10 %in% shp_bnd_elem_dist_pins$pin10) %>%
filter(is.na(as.logical(st_intersects(st_centroid(.), shp_bnd_riverside)))) %>%
filter(is.na(as.logical(st_intersects(st_centroid(.), shp_bnd_elem_dist))))
shp_bnd_hs_dist <- read_sf(paste0(
"https://opendata.arcgis.com/api/v3/datasets/",
"0657c2831de84e209863eac6c9296081_6/downloads/data?",
"format=geojson&spatialRefId=4326&where=1%3D1"
)) %>%
filter(AGENCY_DESC == "RIVERSIDE BROOKFIELD HIGH SCHOOL 208")
shp_bnd_hs_dist_pins <- read_sf(glue(
"https://datacatalog.cookcountyil.gov/resource/",
"77tz-riq7.geojson?highschltaxdist=RIVERSIDE%20BROOKFIELD%20HIGH%20SCHOOL%20208",
"&$limit=50000"
)) %>%
filter(!pin10 %in% shp_bnd_riverside_pins$pin10) %>%
filter(!pin10 %in% shp_bnd_elem_dist_pins$pin10) %>%
filter(!pin10 %in% shp_bnd_township_pins$pin10) %>%
filter(is.na(as.logical(st_intersects(st_centroid(.), shp_bnd_riverside)))) %>%
filter(is.na(as.logical(st_intersects(st_centroid(.), shp_bnd_elem_dist)))) %>%
filter(is.na(as.logical(st_intersects(st_centroid(.), shp_bnd_township))))
(p1_1_cook <- ggplot() +
geom_sf(data = shp_bnd_cook) +
geom_sf(data = shp_bnd_chicago) +
geom_sf(data = shp_bnd_riverside, fill = "#6a3d9a") +
theme_void())
(p1_1_cook <- ggplot() +
geom_sf(data = shp_bnd_cook) +
geom_sf(data = shp_bnd_chicago) +
geom_sf(data = shp_bnd_riverside, fill = "#6a3d9a") +
theme_void())
p1_1_riverside_levy <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
theme_void()
p1_1_riverside_levy
p1_1_riverside_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white",
alpha = 0.75
) +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void()
p1_1_riverside_base
p1_1_elem_dist_levy <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void()
p1_1_elem_dist_levy
p1_1_elem_dist_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_elem_dist_pins,
fill = "#fdbf6f",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void()
p1_1_elem_dist_base
p1_1_township_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_elem_dist_pins,
fill = "#fdbf6f",
color = "white"
) +
geom_sf(
data = shp_bnd_township_pins,
fill = "#b2df8a",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_township,
color = "#33a02c",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void()
p1_1_township_base
setwd("~/ptax-project")
library(data.table)
library(dplyr)
library(here)
library(ggplot2)
library(ggspatial)
library(glue)
library(ptaxsim)
library(sf)
library(tidyr)
ptaxsim_db_conn <- DBI::dbConnect(RSQLite::SQLite(), here("ptaxsim.db"))
example_pin10 <- "1536100028"
example_pin14 <- "15361000280000"
(p1_1_cook <- ggplot() +
geom_sf(data = shp_bnd_cook) +
geom_sf(data = shp_bnd_chicago) +
geom_sf(data = shp_bnd_riverside, fill = "#6a3d9a") +
theme_void())
(p1_1_riverside_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white",
alpha = 0.75
) +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_riverside_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white",
alpha = 0.75
) +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_riverside_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white",
alpha = 0.75
) +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_riverside_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white",
alpha = 0.75
) +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_elem_dist_levy <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_riverside_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white",
alpha = 0.75
) +
geom_sf(
data = shp_bnd_riverside,
color = "#6a3d9a",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_elem_dist_levy <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_elem_dist_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_elem_dist_pins,
fill = "#fdbf6f",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
(p1_1_township_base <- ggplot() +
annotation_map_tile("cartolight", zoomin = -1) +
annotation_scale(location = "br", unit_category = "imperial") +
geom_sf(
data = shp_bnd_riverside_pins,
fill = "#cab2d6",
color = "white"
) +
geom_sf(
data = shp_bnd_elem_dist_pins,
fill = "#fdbf6f",
color = "white"
) +
geom_sf(
data = shp_bnd_township_pins,
fill = "#b2df8a",
color = "white"
) +
geom_sf(
data = shp_bnd_riverside,
color = "#984ea3",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_elem_dist,
color = "#ff7f00",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_township,
color = "#33a02c",
fill = "transparent",
linewidth = 1
) +
geom_sf(
data = shp_bnd_example_pin,
fill = "#e41a1c"
) +
theme_void())
